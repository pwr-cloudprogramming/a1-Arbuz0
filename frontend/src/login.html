<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Login</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <h2>Login to Play Tic Tac Toe</h2>
    <button type="button" class="btn btn-primary" onclick="redirectToHostedUI()">Login with Cognito</button>
</div>

<script src="js/cognito-config.js"></script>
<script>
    function redirectToHostedUI() {
        const loginUrl = `https://${COGNITO_DOMAIN}/login?client_id=${COGNITO_CLIENT_ID}&response_type=token&scope=email+openid+profile&redirect_uri=${encodeURIComponent(`${window.location.protocol}//${window.location.hostname}:8081`)}`;
        console.log('Redirecting to:', loginUrl);
        window.location.href = loginUrl;
    }

    window.onload = function() {
        const hash = window.location.hash.substr(1);
        console.log('Hash received:', hash);
        const result = {};
        hash.split('&').forEach(function (item) {
            const parts = item.split('=');
            result[parts[0]] = decodeURIComponent(parts[1]);
        });

        console.log('Parsed result:', result);

        if (result.id_token) {
            console.log('ID token found:', result.id_token);
            localStorage.setItem('idToken', result.id_token);
            window.location.href = 'index.html'; // Redirect to your main application
        } else {
            console.error('ID token not found in URL hash');
        }
    };
</script>
</body>
</html>
